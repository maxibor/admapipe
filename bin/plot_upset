#!/usr/bin/env python

import argparse
import matplotlib.pyplot as plt
import pyupset as pyu
import pandas as pd


def get_args():
    '''This function parses and return arguments passed in'''
    parser = argparse.ArgumentParser(
        prog='plot_upset',
        description='plot upset plot for OTU binary count table of different methods')
    parser.add_argument('infile', help="path to csv binary count file")
    parser.add_argument(
        '-o',
        dest="output",
        default="upset_plot.png",
        help="Output file. Default = upset_plot.png")

    args = parser.parse_args()

    infile = args.infile
    outfile = args.output

    return(infile, outfile)


def pd2dict(pd_df):
    """
    Converts a Pandas Dataframe to a dictionary of Pandas dataframe
    """
    d_dict = {}
    all_tax = list(d.index)
    for i in range(1, d.shape[1]):
        d_dict[d.columns[i]] = []
        for j in range(0, d.shape[0]):
            if d.iloc[j, i] == 1:
                d_dict[d.columns[i]].append(all_tax[j])
        d_dict[d.columns[i]] = pd.DataFrame(d_dict[d.columns[i]])
    return(d_dict)


if __name__ == "__main__":
    INFILE, OUTFILE = get_args()
    d = pd.read_csv(INFILE, index_col=0)
    d_dict = pd2dict(d)
    p = pyu.plot(d_dict, inters_size_bounds=(1, 9999999999999999999999))
    plt.savefig(OUTFILE)
